{"version":3,"file":"v-click-outside.umd.js","sources":["../src/utils.js","../src/v-click-outside.js","../src/index.js"],"sourcesContent":["import { isVue3 } from 'vue-demi'\n\n// eslint-disable-next-line\nexport const directiveHooks = {\n  beforeMount: isVue3 ? 'beforeMount' : 'bind',\n  updated: isVue3 ? 'updated' : 'update',\n  unmounted: isVue3 ? 'unmounted' : 'unbind',\n}\n","import { directiveHooks } from './utils'\n\nconst HANDLERS_PROPERTY = '__v-click-outside'\nconst HAS_WINDOWS = typeof window !== 'undefined'\nconst HAS_NAVIGATOR = typeof navigator !== 'undefined'\nconst IS_TOUCH =\n  HAS_WINDOWS &&\n  ('ontouchstart' in window ||\n    (HAS_NAVIGATOR && navigator.msMaxTouchPoints > 0))\nconst EVENTS = IS_TOUCH ? ['touchstart'] : ['click']\n\nfunction processDirectiveArguments(bindingValue) {\n  const isFunction = typeof bindingValue === 'function'\n  if (!isFunction && typeof bindingValue !== 'object') {\n    throw new Error(\n      'v-click-outside: Binding value must be a function or an object',\n    )\n  }\n\n  return {\n    handler: isFunction ? bindingValue : bindingValue.handler,\n    middleware: bindingValue.middleware || ((item) => item),\n    events: bindingValue.events || EVENTS,\n    isActive: !(bindingValue.isActive === false),\n    detectIframe: !(bindingValue.detectIframe === false),\n    capture: !!bindingValue.capture,\n  }\n}\n\nfunction execHandler({ event, handler, middleware }) {\n  if (middleware(event)) {\n    handler(event)\n  }\n}\n\nfunction onFauxIframeClick({ el, event, handler, middleware }) {\n  // Note: on firefox clicking on iframe triggers blur, but only on\n  //       next event loop it becomes document.activeElement\n  // https://stackoverflow.com/q/2381336#comment61192398_23231136\n  setTimeout(() => {\n    const { activeElement } = document\n    if (\n      activeElement &&\n      activeElement.tagName === 'IFRAME' &&\n      !el.contains(activeElement)\n    ) {\n      execHandler({ event, handler, middleware })\n    }\n  }, 0)\n}\n\nfunction onEvent({ el, event, handler, middleware }) {\n  // Note: composedPath is not supported on IE and Edge, more information here:\n  //       https://developer.mozilla.org/en-US/docs/Web/API/Event/composedPath\n  //       In the meanwhile, we are using el.contains for those browsers, not\n  //       the ideal solution, but using IE or EDGE is not ideal either.\n  const path = (event.composedPath && event.composedPath()) || event.path\n  const isClickOutside = path\n    ? path.indexOf(el) < 0\n    : !el.contains(event.target)\n\n  if (!isClickOutside) {\n    return\n  }\n\n  execHandler({ event, handler, middleware })\n}\n\nfunction bind(el, { value }) {\n  const {\n    events,\n    handler,\n    middleware,\n    isActive,\n    detectIframe,\n    capture,\n  } = processDirectiveArguments(value)\n  if (!isActive) {\n    return\n  }\n\n  el[HANDLERS_PROPERTY] = events.map((eventName) => ({\n    event: eventName,\n    srcTarget: document.documentElement,\n    handler: (event) => onEvent({ el, event, handler, middleware }),\n    capture,\n  }))\n\n  if (detectIframe) {\n    const detectIframeEvent = {\n      event: 'blur',\n      srcTarget: window,\n      handler: (event) => onFauxIframeClick({ el, event, handler, middleware }),\n      capture,\n    }\n\n    el[HANDLERS_PROPERTY] = [...el[HANDLERS_PROPERTY], detectIframeEvent]\n  }\n\n  el[HANDLERS_PROPERTY].forEach(({ event, srcTarget, handler }) =>\n    setTimeout(() => {\n      // Note: More info about this implementation can be found here:\n      //       https://github.com/ndelvalle/v-click-outside/issues/137\n      if (!el[HANDLERS_PROPERTY]) {\n        return\n      }\n      srcTarget.addEventListener(event, handler, capture)\n    }, 0),\n  )\n}\n\nfunction unbind(el) {\n  const handlers = el[HANDLERS_PROPERTY] || []\n  handlers.forEach(({ event, srcTarget, handler, capture }) =>\n    srcTarget.removeEventListener(event, handler, capture),\n  )\n  delete el[HANDLERS_PROPERTY]\n}\n\nfunction update(el, { value, oldValue }) {\n  if (JSON.stringify(value) === JSON.stringify(oldValue)) {\n    return\n  }\n  unbind(el)\n  bind(el, { value })\n}\n\nconst directive = {\n  [directiveHooks.beforeMount]: bind,\n  [directiveHooks.updated]: update,\n  [directiveHooks.unmounted]: unbind,\n}\n\nexport default HAS_WINDOWS ? directive : {}\n","import directive from './v-click-outside'\n\nconst plugin = {\n  install(Vue) {\n    Vue.directive('click-outside', directive)\n  },\n  directive,\n}\n\nexport default plugin\n"],"names":["isVue3","HAS_WINDOWS","HAS_NAVIGATOR","navigator","msMaxTouchPoints","event","handler","middleware","el","bindingValue","isFunction","item","events","EVENTS","isActive","detectIframe","capture","processDirectiveArguments","value","HANDLERS_PROPERTY","map","eventName","srcTarget","document","documentElement","composedPath","path","indexOf","contains","target","execHandler","window","setTimeout","activeElement","tagName","detectIframeEvent","forEach","addEventListener","removeEventListener","bind","directiveHooks","oldValue","JSON","stringify","unbind","directive","install","Vue"],"mappings":"uRAKWA,SAAS,UAAY,WACnBA,SAAS,YAAc,WCJV,sBACY,6BACK,gCAEzCC,IACC,yBACEC,GAAiBC,UAAUC,iBAAmB,GACzB,CAAC,cAAgB,CAAC,SAoB5C,sBAAuBC,MAAOC,IAAAA,SACxBC,IADiCA,YACtBF,IACbC,EAAQD,GAqCZ,WAAcG,WAzDd,SAAmCC,GACjC,MAA2C,qBAC3C,IAAKC,GAAsC,mBACzC,gBACE,kEAIJ,MAAO,CACLJ,QAASI,EAAaD,EAAeA,EAAaH,QAClDC,WAAYE,EAAaF,YAAe,SAACI,aACzCC,OAAQH,EAAaG,QAAUC,EAC/BC,YAAsC,IAA1BL,EAAaK,UACzBC,gBAA8C,IAA9BN,EAAaM,cAC7BC,UAAWP,EAAaO,SAmDtBC,GARcC,OAGhBZ,IAAAA,QACAC,IAAAA,WAEAQ,IAAAA,aACAC,IAAAA,QAEF,KAJEF,SAIF,CAWA,GAPAN,EAAGW,KAXDP,OAW6BQ,IAAI,SAACC,SAAe,CACjDhB,MAAOgB,EACPC,UAAWC,SAASC,gBACpBlB,QAAS,SAACD,UAjCd,oBAAmBG,GAAIH,IAAAA,MAAOC,IAAAA,QAASC,IAAAA,aAKvBF,EAAMoB,cAAgBpB,EAAMoB,gBAAmBpB,EAAMqB,MAC5CA,EACnBA,EAAKC,QAAQnB,GAAM,GAClBA,EAAGoB,SAASvB,EAAMwB,UAMvBC,EAAY,CAAEzB,MAAAA,EAAOC,QAAAA,EAASC,WAAAA,KAmBA,CAAEC,GAAAA,EAAIH,MAAAA,EAAOC,QAAAA,EAASC,WAAAA,KAClDS,QAAAA,KAGED,EAAc,CAChB,MAA0B,CACxBV,MAAO,OACPiB,UAAWS,OACXzB,QAAS,SAACD,UAzDhB,oBAA6BG,GAAIH,IAAAA,MAAOC,IAAAA,QAASC,IAAAA,WAI/CyB,WAAW,WACT,IAAQC,EAAkBV,SAAlBU,cAENA,GAC0B,WAA1BA,EAAcC,UACb1B,EAAGoB,SAASK,IAEbH,EAAY,CAAEzB,MAAAA,EAAOC,QAAAA,EAASC,WAAAA,KAE/B,IA4CuC,CAAEC,GAAAA,EAAIH,MAAAA,EAAOC,QAAAA,EAASC,WAAAA,KAC5DS,QAAAA,GAGFR,EAAGW,aAAyBX,EAAGW,IAAoBgB,IAGrD3B,EAAGW,GAAmBiB,QAAQ,oBAAG/B,MAAOiB,IAAAA,UAAWhB,IAAAA,0BACtC,WAGJE,EAAGW,IAGRG,EAAUe,iBAAiBhC,EAAOC,EAASU,IAC1C,MAIP,WAAgBR,IACGA,EAAGW,IAAsB,IACjCiB,QAAQ,qBAAUd,UACfgB,sBADQjC,QAAkBC,UAASU,oBAGrCG,GAWZ,cD3HenB,SAAS,cAAgB,QC4HRuC,IAC7BC,GAVH,SAAgBhC,aAAMU,MAAOuB,IAAAA,SACvBC,KAAKC,UAAUzB,KAAWwB,KAAKC,UAAUF,KAG7CG,EAAOpC,GACP+B,EAAK/B,EAAI,CAAEU,MAAAA,QAMVsB,GAA2BI,SAGDC,EAAY,SCnI1B,CACbC,iBAAQC,GACNA,EAAIF,UAAU,gBAAiBA,IAEjCA,UAAAA"}